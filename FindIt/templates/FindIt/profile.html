{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/profile.css' %}">
<div class="container mt-5 mb-5">
    <!-- Profile Header Card -->
    <div class="row justify-content-center mb-4">
        <div class="col-12">
            <div class="profile-card text-center py-5">
                <div class="container">
                    <div class="row align-items-center">
                        <!-- Profile Picture -->
                        <div class="col-md-4 mb-4 mb-md-0">
                            <div class="profile-pic-hover mx-auto">
                                {% if profile.profile_picture %}
                                    <img src="{{ profile.profile_picture.url }}" alt="Profile Picture">
                                {% else %}
                                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=D97706&color=fff&size=200" alt="Default Profile Picture">
                                {% endif %}

                                <!-- Overlay icons -->
                                <div class="icon-overlay-center">
                                    <!-- Upload -->
                                    <span class="camera-overlay rounded-circle p-2 d-flex align-items-center justify-content-center"
                                          style="width:45px;height:45px;"
                                          onclick="document.getElementById('profilePicInput').click();">
                                        <i class="bi bi-camera-fill text-white" style="font-size:1.3rem;"></i>
                                    </span>

                                    <!-- Remove -->
                                    {% if user.userprofile.profile_picture %}
                                    <form method="post" action="{% url 'remove_profile_picture' %}" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit"
                                                class="btn btn-danger p-2 rounded-circle camera-overlay"
                                                title="Remove Profile Picture"
                                                style="width:45px;height:45px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#dc2626,#ef4444)!important;border:none;">
                                            <i class="bi bi-trash text-white"></i>
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>

                                <!-- Hidden upload form -->
                                <form id="profilePicUploadForm" method="post" action="{% url 'upload_profile_picture' %}" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="file" id="profilePicInput" name="profile_picture" accept="image/*" style="display:none;" onchange="document.getElementById('profilePicUploadForm').submit();">
                                </form>
                            </div>
                        </div>

                        <!-- User Info -->
                        <div class="col-md-8 text-md-start">
                            <div class="user-info-wrapper">
                                <h2 class="user-name mb-3">
                                    {{ user.first_name }} {{ user.last_name }}
                                </h2>
                                
                                <div class="user-details mb-4">
                                    <div class="detail-item">
                                        <i class="bi bi-at"></i>
                                        <span class="detail-text">{{ user.username }}</span>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-envelope"></i>
                                        <span class="detail-text">{{ user.email }}</span>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-calendar-check"></i>
                                        <span class="detail-text">Joined {{ user.date_joined|date:"F Y" }}</span>
                                    </div>
                                </div>

                                <div class="profile-actions">
                                    <a href="{% url 'edit_profile' %}" class="btn btn-edit-profile">
                                        <i class="bi bi-pencil-square me-2"></i>Edit Profile
                                    </a>
                                    <a href="{% url 'logout' %}" class="btn btn-logout">
                                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Information and Statistics -->
    <div class="row justify-content-center">
        <div class="col-lg-8 mb-4">
            <div class="profile-card p-4">
                <h4 class="section-header">
                    <i class="bi bi-info-circle me-2"></i>Profile Information
                </h4>
                
                <div class="info-item">
                    <span class="info-label"><i class="bi bi-person me-2"></i>Full Name</span>
                    <span class="info-value">{{ user.first_name }} {{ user.last_name }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label"><i class="bi bi-envelope me-2"></i>Email Address</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label"><i class="bi bi-telephone me-2"></i>Phone Number</span>
                    <span class="info-value">{{ profile.contact_number|default:"Not provided" }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label"><i class="bi bi-geo-alt me-2"></i>Address</span>
                    <span class="info-value">{{ profile.address|default:"Not provided" }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label"><i class="bi bi-person-lines-fill me-2"></i>Bio</span>
                    <span class="info-value">{{ profile.bio|default:"No bio provided yet" }}</span>
                </div>

                {% if profile.social_links %}
                <div class="info-item">
                    <span class="info-label"><i class="bi bi-link-45deg me-2"></i>Social Link</span>
                    <span class="info-value">
                        <a href="{{ profile.social_links }}" target="_blank" rel="noopener" style="color: var(--primary); text-decoration: none;">
                            {{ profile.social_links }}
                        </a>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Statistics Column -->
        <div class="col-lg-4 mb-4">
            <div class="mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ user.item_set.count }}</div>
                    <div class="stat-label">Items Reported</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="stat-card">
                    <div class="stat-number">
                        {% if profile.reputation_score %}
                            {{ profile.reputation_score|floatformat:1 }}
                        {% else %}
                            0.0
                        {% endif %}
                    </div>
                    <div class="stat-label">Reputation Score</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ profile.total_returns|default:0 }}</div>
                    <div class="stat-label">Items Returned</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var pic = document.querySelector('.profile-pic-hover');
    if (pic) {
        pic.addEventListener('touchstart', function() {
            pic.classList.add('touch-active');
        });
        pic.addEventListener('touchend', function() {
            setTimeout(function() {
                pic.classList.remove('touch-active');
            }, 2000);
        });
    }
});
</script>
{% endblock %}
