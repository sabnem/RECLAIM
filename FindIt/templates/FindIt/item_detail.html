{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card shadow-lg border-0 bg-white rounded-4">
      {% if item.photo %}
        <img src="{{ item.photo.url }}" class="card-img-top" style="max-height:300px;object-fit:cover;" alt="Item photo">
      {% endif %}
      <div class="card-body p-5">
        <h2 class="card-title fw-bold mb-3">{{ item.title }}</h2>
        <span class="badge {% if item.status == 'lost' %}bg-danger{% else %}bg-success{% endif %} me-1">{{ item.get_status_display }}</span>
        <span class="badge bg-secondary me-1">{{ item.category }}</span>
        {% if item.is_returned %}
          <span class="badge bg-info text-dark me-1"><i class="bi bi-check-circle"></i> Returned</span>
        {% endif %}
        <div class="mt-3"><strong>Description:</strong> {{ item.description }}</div>
        <div><strong>Location:</strong> <i class="bi bi-geo-alt"></i> {{ item.location }}</div>
        <div><strong>Reported by:</strong> <i class="bi bi-person"></i> {{ item.reported_by.username }}</div>
        <div><strong>Date Reported:</strong> <i class="bi bi-calendar-event"></i> {{ item.date_reported|date:'Y-m-d H:i' }}</div>
        <div class="d-flex flex-wrap gap-2 mt-4">
          {% if user.is_authenticated and user != item.reported_by %}
            <a href="{% url 'inbox' %}?item_id={{ item.id }}&recipient_id={{ item.reported_by.id }}" class="btn btn-warning"><i class="bi bi-chat-dots"></i> Send In-site Message</a>
          {% endif %}
          {% if user.is_authenticated and user == item.reported_by %}
            <form method="post" action="{% url 'mark_item_returned' item.id %}" style="display:inline;">
              {% csrf_token %}
              {% if item.is_returned %}
                <button type="submit" class="btn btn-outline-info"><i class="bi bi-x-circle"></i> Mark as Not Returned</button>
              {% else %}
                <button type="submit" class="btn btn-info text-white"><i class="bi bi-check-circle"></i> Mark as Returned</button>
              {% endif %}
            </form>
          {% elif user.is_authenticated and user.is_superuser %}
            <form method="post" action="{% url 'mark_item_returned' item.id %}" style="display:inline;">
              {% csrf_token %}
              {% if item.is_returned %}
                <button type="submit" class="btn btn-outline-info"><i class="bi bi-x-circle"></i> Mark as Not Returned</button>
              {% else %}
                <button type="submit" class="btn btn-info text-white"><i class="bi bi-check-circle"></i> Mark as Returned</button>
              {% endif %}
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
